<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlayStella - Daily Cat Game</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide React icons as inline SVG components
    const Heart = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
      </svg>
    );

    const Hand = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"/>
        <path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"/>
        <path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/>
        <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/>
      </svg>
    );

    const Cookie = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/>
        <path d="M8.5 8.5v.01"/>
        <path d="M16 15.5v.01"/>
        <path d="M12 12v.01"/>
        <path d="M11 17v.01"/>
        <path d="M7 14v.01"/>
      </svg>
    );

    const XCircle = ({ size = 24, className = "", strokeWidth = 2 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10"/>
        <path d="m15 9-6 6"/>
        <path d="m9 9 6 6"/>
      </svg>
    );

    const StellaCatGame = () => {
      const [gameState, setGameState] = useState('start');
      const [timer, setTimer] = useState(0);
      const [catMood, setCatMood] = useState(100);
      const [patience, setPatience] = useState(100);
      const [catAnimation, setCatAnimation] = useState('idle');
      const [lastActionTime, setLastActionTime] = useState(Date.now());
      const [dailySeed, setDailySeed] = useState(0);
      const [actionCounts, setActionCounts] = useState({ pet: 0, leave: 0, treat: 0, end: 0 });
      const [timeLeft, setTimeLeft] = useState(3);
      const [showCopied, setShowCopied] = useState(false);
      const [actionHistory, setActionHistory] = useState([]);
      const [hasPlayedToday, setHasPlayedToday] = useState(false);
      const [bestTime, setBestTime] = useState(null);
      const [streak, setStreak] = useState(0);
      const [nextPlayTime, setNextPlayTime] = useState(null);

      // Generate daily seed based on date
      useEffect(() => {
        const today = new Date().toDateString();
        const seed = today.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
        setDailySeed(seed);
        
        // Check if user has already played today
        const lastPlayDate = localStorage.getItem('stellaLastPlayDate');
        const hasPlayed = lastPlayDate === today;
        setHasPlayedToday(hasPlayed);
        
        // Load best time
        const savedBestTime = localStorage.getItem('stellaBestTime');
        if (savedBestTime) {
          setBestTime(parseFloat(savedBestTime));
        }
        
        // Load and calculate streak
        const lastPlayDateStr = localStorage.getItem('stellaLastPlayDate');
        const currentStreakStr = localStorage.getItem('stellaStreak');
        
        if (lastPlayDateStr && currentStreakStr) {
          const lastPlay = new Date(lastPlayDateStr);
          const todayDate = new Date(today);
          const yesterday = new Date(todayDate);
          yesterday.setDate(yesterday.getDate() - 1);
          
          // Check if last play was yesterday (continue streak) or today (maintain streak)
          if (lastPlayDateStr === yesterday.toDateString()) {
            setStreak(parseInt(currentStreakStr));
          } else if (lastPlayDateStr === today) {
            setStreak(parseInt(currentStreakStr));
          } else {
            // Streak broken
            setStreak(0);
            localStorage.setItem('stellaStreak', '0');
          }
        }
        
        // Calculate next play time (midnight tonight)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        setNextPlayTime(tomorrow);
      }, []);

      // Seeded random number generator for specific action + count
      const getSeededRandom = (actionName, count) => {
        const actionSeed = actionName.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
        const combinedSeed = dailySeed + actionSeed + count;
        const x = Math.sin(combinedSeed) * 10000;
        return x - Math.floor(x);
      };

      // Timer effect
      useEffect(() => {
        let interval;
        if (gameState === 'playing') {
          interval = setInterval(() => {
            setTimer(prev => prev + 0.1);
          }, 100);
        }
        return () => clearInterval(interval);
      }, [gameState]);

      // Check if cat swipes
      useEffect(() => {
        if (gameState === 'playing' && patience <= 0) {
          endGame();
        }
      }, [patience, gameState]);

      // Inactivity timer
      useEffect(() => {
        let countdownInterval;
        
        if (gameState === 'playing') {
          setTimeLeft(3);
          
          // Update countdown every 50ms for smoother animation
          countdownInterval = setInterval(() => {
            const elapsed = (Date.now() - lastActionTime) / 1000;
            const remaining = Math.max(0, 3 - elapsed);
            setTimeLeft(remaining);
            
            // End game when time runs out
            if (remaining <= 0) {
              endGame();
            }
          }, 50);
        }
        
        return () => {
          clearInterval(countdownInterval);
        };
      }, [gameState, lastActionTime]);

      const startGame = () => {
        // Prevent starting if already played today
        if (hasPlayedToday) {
          return;
        }
        
        setGameState('playing');
        setTimer(0);
        setActionCounts({ pet: 0, leave: 0, treat: 0, end: 0 });
        setActionHistory([]);
        
        // Seeded starting stats
        const moodRng = Math.sin(dailySeed * 1.1) * 10000;
        const patienceRng = Math.sin(dailySeed * 1.2) * 10000;
        setCatMood(80 + Math.floor((moodRng - Math.floor(moodRng)) * 20));
        setPatience(70 + Math.floor((patienceRng - Math.floor(patienceRng)) * 30));
        
        setCatAnimation('idle');
        setLastActionTime(Date.now());
      };

      const endGame = () => {
        setGameState('gameOver');
        setCatAnimation('swipe');
        
        // Save that user played today
        const today = new Date().toDateString();
        localStorage.setItem('stellaLastPlayDate', today);
        setHasPlayedToday(true);
        
        // Update best time if this is better
        const currentTime = parseFloat(timer.toFixed(1));
        const savedBestTime = localStorage.getItem('stellaBestTime');
        if (!savedBestTime || currentTime > parseFloat(savedBestTime)) {
          localStorage.setItem('stellaBestTime', currentTime.toString());
          setBestTime(currentTime);
        }
        
        // Update streak
        const lastPlayDateStr = localStorage.getItem('stellaLastPlayDate');
        const currentStreakStr = localStorage.getItem('stellaStreak') || '0';
        
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toDateString();
        
        let newStreak = 1;
        if (lastPlayDateStr === yesterdayStr) {
          // Played yesterday, increment streak
          newStreak = parseInt(currentStreakStr) + 1;
        } else if (lastPlayDateStr === today) {
          // Already played today (shouldn't happen but just in case)
          newStreak = parseInt(currentStreakStr);
        }
        // else: streak broken, reset to 1
        
        localStorage.setItem('stellaStreak', newStreak.toString());
        setStreak(newStreak);
      };

      const performAction = (actionName) => {
        if (gameState !== 'playing') return;
        
        setLastActionTime(Date.now());
        setTimeLeft(3);
        
        const currentCount = actionCounts[actionName];
        setActionCounts(prev => ({ ...prev, [actionName]: prev[actionName] + 1 }));
        
        const emojiRandom = getSeededRandom(actionName + '_emoji', currentCount);
        const outcomeRandom = getSeededRandom(actionName + '_outcome', currentCount);
        
        const randomExpressions = ['😺', '😼', '😾', '🙀'];
        const randomIndex = Math.floor(emojiRandom * randomExpressions.length);
        const randomExpression = randomExpressions[randomIndex];
        
        setCatAnimation(randomExpression);
        
        // Determine outcome tier for history tracking
        let outcomeTier;
        if (outcomeRandom < 0.10) {
          setPatience(prev => Math.max(0, prev - 40));
          setCatMood(prev => Math.max(0, prev - 25));
          outcomeTier = 'terrible';
        } else if (outcomeRandom < 0.25) {
          setPatience(prev => Math.max(0, prev - 25));
          setCatMood(prev => Math.max(0, prev - 15));
          outcomeTier = 'bad';
        } else if (outcomeRandom < 0.45) {
          setPatience(prev => Math.max(0, prev - 12));
          setCatMood(prev => Math.max(0, prev - 8));
          outcomeTier = 'okay';
        } else if (outcomeRandom < 0.65) {
          setPatience(prev => Math.max(0, prev - 5));
          setCatMood(prev => prev);
          outcomeTier = 'neutral';
        } else if (outcomeRandom < 0.82) {
          setPatience(prev => Math.min(100, prev + 10));
          setCatMood(prev => Math.min(100, prev + 8));
          outcomeTier = 'good';
        } else if (outcomeRandom < 0.95) {
          setPatience(prev => Math.min(100, prev + 20));
          setCatMood(prev => Math.min(100, prev + 15));
          outcomeTier = 'great';
        } else {
          setPatience(prev => Math.min(100, prev + 35));
          setCatMood(prev => Math.min(100, prev + 25));
          outcomeTier = 'excellent';
        }
        
        // Add to history
        setActionHistory(prev => [...prev, { action: actionName, outcome: outcomeTier }]);
        
        setTimeout(() => setCatAnimation('idle'), 500);
      };

      const getCatExpression = () => {
        if (catAnimation === 'swipe') return '😾';
        if (['😺', '😼', '😾', '🙀'].includes(catAnimation)) return catAnimation;
        return '😺';
      };

      const shareResult = async () => {
        const today = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const timeScore = timer.toFixed(1);
        
        const shareText = `Stella the Cat 🐱
${today}

⏱️ ${timeScore}s | ${actionHistory.length} actions

Can you beat my score?`;
        
        // Try Web Share API first (mobile)
        if (navigator.share) {
          try {
            await navigator.share({
              title: 'Stella the Cat',
              text: shareText
            });
            // Don't show "copied" message for successful share
            return;
          } catch (err) {
            // User cancelled or share failed, fall through to clipboard
            if (err.name !== 'AbortError') {
              console.log('Share failed:', err);
            }
          }
        }
        
        // Fallback to clipboard (desktop or if share fails)
        navigator.clipboard.writeText(shareText).then(() => {
          setShowCopied(true);
          setTimeout(() => setShowCopied(false), 2000);
        }).catch(() => {
          // If clipboard also fails, just show the copied state anyway
          setShowCopied(true);
          setTimeout(() => setShowCopied(false), 2000);
        });
      };

      return (
        <div className="w-full min-h-screen bg-gray-50 flex flex-col items-center justify-center p-8">
          <div className="max-w-xl w-full flex-grow flex items-center justify-center">
            
            {gameState === 'start' && (
              <div className="text-center space-y-16">
                <div className="space-y-4">
                  <h1 className="text-6xl font-light tracking-tight text-gray-900">PlayStella</h1>
                  <p className="text-lg font-light text-gray-500 max-w-md mx-auto leading-relaxed">
                    Daily Cat Game
                  </p>
                </div>

                <div className="text-9xl">😺</div>

                {hasPlayedToday ? (
                  <div className="space-y-8 max-w-xs mx-auto">
                    <div className="space-y-6">
                      <h2 className="text-2xl font-light text-gray-900">Come back tomorrow!</h2>
                      
                      <div className="space-y-4 pt-4">
                        {bestTime && (
                          <div className="bg-white rounded-2xl p-6">
                            <p className="text-xs font-medium text-gray-400 uppercase tracking-widest mb-2">Best Time</p>
                            <p className="text-3xl font-light text-gray-900">{bestTime}s</p>
                          </div>
                        )}
                        
                        {streak > 0 && (
                          <div className="bg-white rounded-2xl p-6">
                            <p className="text-xs font-medium text-gray-400 uppercase tracking-widest mb-2">Streak</p>
                            <p className="text-3xl font-light text-gray-900">{streak} {streak === 1 ? 'day' : 'days'} 🔥</p>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="space-y-8 max-w-xs mx-auto">
                    <div className="space-y-4 text-left">
                      <p className="text-xs font-medium text-gray-400 uppercase tracking-widest">How to Play</p>
                      <div className="space-y-3 text-sm text-gray-600 leading-relaxed">
                        <p>Choose actions to interact with Stella</p>
                        <p>You have 3 seconds between each action</p>
                        <p>Everyone gets the same Stella each day</p>
                      </div>
                    </div>
                    
                    {(bestTime || streak > 0) && (
                      <div className="space-y-3 pt-2">
                        {bestTime && (
                          <div className="bg-white rounded-2xl p-4 flex items-center justify-between">
                            <p className="text-xs font-medium text-gray-400 uppercase tracking-widest">Best Time</p>
                            <p className="text-xl font-light text-gray-900">{bestTime}s</p>
                          </div>
                        )}
                        
                        {streak > 0 && (
                          <div className="bg-white rounded-2xl p-4 flex items-center justify-between">
                            <p className="text-xs font-medium text-gray-400 uppercase tracking-widest">Streak</p>
                            <p className="text-xl font-light text-gray-900">{streak} {streak === 1 ? 'day' : 'days'} 🔥</p>
                          </div>
                        )}
                      </div>
                    )}

                    <button
                      onClick={startGame}
                      className="w-full py-4 bg-gray-900 text-white text-sm font-medium rounded-full hover:bg-gray-800 transition-all duration-200 tracking-wide"
                    >
                      Start
                    </button>
                  </div>
                )}
              </div>
            )}

            {gameState === 'playing' && (
              <div className="space-y-16">
                {/* Countdown Progress Bar */}
                <div className="w-full">
                  <div className="w-full h-0.5 bg-gray-200 rounded-full overflow-hidden">
                    <div 
                      className="h-full transition-all duration-100 ease-linear rounded-full"
                      style={{ 
                        width: `${(timeLeft / 3) * 100}%`,
                        backgroundColor: '#1f2937'
                      }}
                    />
                  </div>
                </div>

                <div className="text-center space-y-1">
                  <div className="text-5xl font-light tabular-nums text-gray-900">
                    {timer.toFixed(1)}
                  </div>
                  <div className="text-xs font-light text-gray-400 uppercase tracking-widest">Seconds</div>
                </div>

                <div className="text-center py-4">
                  <div className="text-9xl inline-block transform transition-transform duration-300" 
                       style={{ 
                         transform: catAnimation === 'swipe' ? 'rotate(15deg) scale(1.1)' : 'scale(1)'
                       }}>
                    {getCatExpression()}
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <button
                    onClick={() => performAction('pet')}
                    className="group py-8 px-6 bg-white rounded-2xl hover:bg-gray-900 transition-all duration-200 flex flex-col items-center gap-3"
                  >
                    <Hand size={24} className="text-gray-400 group-hover:text-white transition-colors" strokeWidth={1.5} />
                    <span className="text-sm font-light text-gray-600 group-hover:text-white transition-colors">Pet</span>
                  </button>

                  <button
                    onClick={() => performAction('leave')}
                    className="group py-8 px-6 bg-white rounded-2xl hover:bg-gray-900 transition-all duration-200 flex flex-col items-center gap-3"
                  >
                    <Heart size={24} className="text-gray-400 group-hover:text-white transition-colors" strokeWidth={1.5} />
                    <span className="text-sm font-light text-gray-600 group-hover:text-white transition-colors">Leave Alone</span>
                  </button>

                  <button
                    onClick={() => performAction('treat')}
                    className="group py-8 px-6 bg-white rounded-2xl hover:bg-gray-900 transition-all duration-200 flex flex-col items-center gap-3"
                  >
                    <Cookie size={24} className="text-gray-400 group-hover:text-white transition-colors" strokeWidth={1.5} />
                    <span className="text-sm font-light text-gray-600 group-hover:text-white transition-colors">Feed Treat</span>
                  </button>

                  <button
                    onClick={() => endGame()}
                    className="group py-8 px-6 bg-white rounded-2xl hover:bg-gray-900 transition-all duration-200 flex flex-col items-center gap-3"
                  >
                    <XCircle size={24} className="text-gray-400 group-hover:text-white transition-colors" strokeWidth={1.5} />
                    <span className="text-sm font-light text-gray-600 group-hover:text-white transition-colors">Walk Away</span>
                  </button>
                </div>
              </div>
            )}

            {gameState === 'gameOver' && (
              <div className="text-center space-y-16">
                <div className="space-y-8">
                  <h2 className="text-4xl font-light text-gray-900">Stella Swiped</h2>
                  <div className="text-9xl">{getCatExpression()}</div>
                </div>

                <div className="space-y-1">
                  <div className="text-6xl font-light tabular-nums text-gray-900">
                    {timer.toFixed(1)}
                  </div>
                  <div className="text-xs font-light text-gray-400 uppercase tracking-widest">Seconds</div>
                </div>
                
                <div className="flex flex-col gap-3 max-w-xs mx-auto">
                  <button
                    onClick={shareResult}
                    className="w-full py-4 bg-blue-600 text-white text-sm font-medium rounded-full hover:bg-blue-700 transition-all duration-200 tracking-wide relative"
                  >
                    {showCopied ? '✓ Copied to Clipboard!' : 'Share Result'}
                  </button>
                  <button
                    onClick={startGame}
                    className="w-full py-4 bg-gray-900 text-white text-sm font-medium rounded-full hover:bg-gray-800 transition-all duration-200 tracking-wide"
                  >
                    Play Again
                  </button>
                  <button
                    onClick={() => setGameState('start')}
                    className="w-full py-4 bg-white text-gray-900 text-sm font-medium rounded-full hover:bg-gray-100 transition-all duration-200 tracking-wide"
                  >
                    Main Menu
                  </button>
                </div>
              </div>
            )}
          </div>
          
          <footer className="w-full max-w-xl mt-8 text-center">
            <p className="text-xs text-gray-400">© 2025 PlayStella. All rights reserved.</p>
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<StellaCatGame />);
  </script>
</body>
</html>
